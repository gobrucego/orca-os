domain: data
version: "1.0.0"

phases:
  # Phase 1: Context Query (MANDATORY)
  context_query:
    order: 1
    required: true
    agent: "ProjectContextServer"
    agent_type: "mcp_tool"
    tool_name: "query_context"
    description: "Load project context before starting data/analytics work"
    inputs:
      - domain: "data"
      - task: "${TASK_DESCRIPTION}"
      - projectPath: "${PROJECT_ROOT}"
      - maxFiles: 15
      - includeHistory: true
    outputs:
      - contextBundle: "Full project awareness for data work"
    next_phase: "requirements_scoping"

  # Phase 2: Requirements & Scoping
  requirements_scoping:
    order: 2
    required: true
    agent: "data-researcher"
    description: "Clarify questions, decisions, and data needs"
    inputs:
      - contextBundle: "${CONTEXT_BUNDLE}"
    outputs:
      - scoped_questions: "List of concrete questions/decisions to answer"
      - data_requirements: "Initial list of needed data sources and fields"
    next_phase: "data_inventory_quality"

  # Phase 3: Data Inventory & Quality Assessment
  data_inventory_quality:
    order: 3
    required: true
    agent: "data-researcher"
    description: "Inventory data sources and assess quality/fitness"
    inputs:
      - scoped_questions: "${PHASE.requirements_scoping.scoped_questions}"
      - data_requirements: "${PHASE.requirements_scoping.data_requirements}"
      - contextBundle: "${CONTEXT_BUNDLE}"
    outputs:
      - data_sources: "Documented list of data sources and locations"
      - data_quality_snapshot: "Short description of completeness/accuracy/recency"
      - caveats: "Known limitations and assumptions"
    next_phase: "analysis_plan"

  # Phase 4: Analysis Plan
  analysis_plan:
    order: 4
    required: true
    agent: "research-specialist"
    description: "Design the analysis approach and checks"
    inputs:
      - scoped_questions: "${PHASE.requirements_scoping.scoped_questions}"
      - data_sources: "${PHASE.data_inventory_quality.data_sources}"
      - data_quality_snapshot: "${PHASE.data_inventory_quality.data_quality_snapshot}"
    outputs:
      - analysis_plan_doc: ".claude/orchestration/specs/data-analysis-plan-${TIMESTAMP}.md"
    next_phase: "implementation"

  # Phase 5: Implementation (Code / Notebooks)
  implementation:
    order: 5
    required: false
    agent: "python-analytics-expert"
    description: "Implement the analysis plan in Python (scripts/notebooks/pipelines)"
    inputs:
      - analysis_plan_doc: "${PHASE.analysis_plan.analysis_plan_doc}"
      - data_sources: "${PHASE.data_inventory_quality.data_sources}"
    constraints:
      max_files_modified: 15
    outputs:
      - code_paths: "List of scripts/notebooks updated or created"
      - run_instructions: "How to re-run the analysis"
    next_phase: "analysis_synthesis"

  # Phase 6: Analysis & Synthesis
  analysis_synthesis:
    order: 6
    required: true
    agent: "research-specialist"
    description: "Run analysis (implemented or ad-hoc) and synthesize findings"
    inputs:
      - scoped_questions: "${PHASE.requirements_scoping.scoped_questions}"
      - data_sources: "${PHASE.data_inventory_quality.data_sources}"
      - data_quality_snapshot: "${PHASE.data_inventory_quality.data_quality_snapshot}"
      - code_paths: "${PHASE.implementation.code_paths}"
    outputs:
      - findings_report: "outputs/data/findings-${TIMESTAMP}.md"
      - summary_brief: "outputs/data/summary-brief-${TIMESTAMP}.md"
    next_phase: "verification"

  # Phase 7: Verification & Handoff
  verification:
    order: 7
    required: true
    agent: "research-specialist"
    description: "Verify quality against rubric and prepare handoff"
    inputs:
      - findings_report: "${PHASE.analysis_synthesis.findings_report}"
      - summary_brief: "${PHASE.analysis_synthesis.summary_brief}"
    outputs:
      - quality_score: "0â€“100 data analytics quality score"
      - gate_status: "PASS | CAUTION | FAIL | BLOCK"
      - handoff_notes: "Notes for stakeholders or downstream pipelines"
    next_phase: "completion"

  # Phase 8: Completion
  completion:
    order: 8
    required: true
    description: "Record outcomes and ensure artifacts are discoverable"
    criteria:
      - all_phases_complete: true
      - findings_report_exists: true
      - summary_brief_exists: true
    outputs_location: "outputs/data/"
    artifacts:
      - "${PHASE.analysis_synthesis.findings_report}"
      - "${PHASE.analysis_synthesis.summary_brief}"
    human_review_required: true
    publish_ready: false

gates:
  data_quality_gate:
    phase: "data_inventory_quality"
    metric: "data_quality_snapshot"
    blocks_if_failed: false

  analysis_rigor_gate:
    phase: "analysis_synthesis"
    metric: "analysis_rigor_score"
    blocks_if_failed: false

  overall_quality_gate:
    phase: "verification"
    threshold: 75
    metric: "quality_score"
    blocks_if_failed: false

config:
  # Output Settings
  output_directory: "outputs/data/"
  slug_format: "kebab-case"

  # Quality Targets
  quality_score_minimum: 75

